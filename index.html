<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LinuxTutor - AI Professor</title>
    
    <!-- Load Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <!-- Styles (CSS) -->
    <style>
        :root {
            --primary: #000000;
            --secondary: #ffffff;
            --gray-50: #F9FAFB;
            --gray-100: #F3F4F6;
            --gray-200: #E5E7EB;
            --gray-500: #6B7280;
            --gray-900: #111827;
            --blue-50: #EFF6FF;
            --blue-600: #2563EB;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }
        
        body { background-color: var(--secondary); color: var(--gray-900); height: 100vh; display: flex; flex-direction: column; overflow: hidden; }
        
        /* Utility Classes */
        .hidden { display: none !important; }
        .flex { display: flex; }
        .flex-col { flex-direction: column; }
        .items-center { align-items: center; }
        .justify-between { justify-content: space-between; }
        .justify-center { justify-content: center; }
        .gap-2 { gap: 0.5rem; }
        .gap-4 { gap: 1rem; }
        .p-4 { padding: 1rem; }
        .p-6 { padding: 1.5rem; }
        .text-sm { font-size: 0.875rem; }
        .font-bold { font-weight: 700; }
        
        /* Navigation */
        nav { height: 64px; border-bottom: 1px solid var(--gray-100); display: flex; align-items: center; justify-content: space-between; padding: 0 1.5rem; }
        .logo { display: flex; align-items: center; gap: 0.5rem; font-weight: 700; font-size: 1.25rem; }
        .logo-icon { background: black; color: white; width: 32px; height: 32px; border-radius: 8px; display: flex; align-items: center; justify-content: center; }
        
        /* Landing Page */
        #landing-page { overflow-y: auto; height: 100%; text-align: center; }
        .hero { padding: 5rem 1rem; max-width: 800px; margin: 0 auto; }
        .badge { display: inline-flex; align-items: center; gap: 6px; background: var(--blue-50); color: var(--blue-600); padding: 4px 12px; border-radius: 99px; font-size: 12px; font-weight: 600; margin-bottom: 2rem; }
        .dot { width: 8px; height: 8px; background: var(--blue-600); border-radius: 50%; }
        h1 { font-size: 3.5rem; line-height: 1.1; letter-spacing: -0.02em; margin-bottom: 1.5rem; }
        .subtitle { font-size: 1.25rem; color: var(--gray-500); margin-bottom: 3rem; line-height: 1.6; }
        
        /* Input Box (Shared Style) */
        .input-wrapper { 
            display: flex; align-items: center; background: white; 
            border: 1px solid var(--gray-200); border-radius: 99px; 
            padding: 6px; box-shadow: 0 10px 30px rgba(0,0,0,0.05);
            max-width: 600px; margin: 0 auto; transition: all 0.2s;
        }
        .input-wrapper:focus-within { border-color: var(--gray-500); box-shadow: 0 10px 40px rgba(0,0,0,0.1); }
        .input-wrapper input { 
            flex: 1; border: none; outline: none; padding: 12px 20px; font-size: 1rem; background: transparent; 
        }
        .send-btn { 
            background: black; color: white; border: none; width: 42px; height: 42px; 
            border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center;
            transition: transform 0.1s;
        }
        .send-btn:hover { transform: scale(1.05); }
        .send-btn:disabled { background: var(--gray-200); cursor: not-allowed; }

        /* Chat Interface */
        #chat-interface { display: flex; height: 100%; overflow: hidden; }
        
        /* Sidebar */
        aside { width: 300px; background: var(--gray-50); border-right: 1px solid var(--gray-200); display: flex; flex-direction: column; }
        .sidebar-header { padding: 1.5rem; border-bottom: 1px solid var(--gray-100); }
        .unit-list { flex: 1; overflow-y: auto; padding: 1rem; }
        .unit-btn { 
            width: 100%; text-align: left; padding: 12px; margin-bottom: 8px; border: 1px solid transparent;
            border-radius: 12px; background: transparent; cursor: pointer; display: flex; align-items: center; gap: 12px;
            transition: all 0.2s;
        }
        .unit-btn:hover { background: white; border-color: var(--gray-200); box-shadow: 0 2px 4px rgba(0,0,0,0.02); }
        .unit-icon { background: var(--gray-200); width: 32px; height: 32px; border-radius: 8px; display: flex; align-items: center; justify-content: center; }
        
        /* Chat Area */
        main { flex: 1; display: flex; flex-direction: column; background: white; position: relative; }
        .chat-header { height: 60px; border-bottom: 1px solid var(--gray-100); display: flex; align-items: center; justify-content: flex-end; padding: 0 1.5rem; }
        .exit-btn { font-size: 0.875rem; color: var(--gray-500); background: none; border: none; cursor: pointer; font-weight: 500; }
        
        #messages-container { flex: 1; overflow-y: auto; padding: 2rem 15%; display: flex; flex-direction: column; gap: 1.5rem; }
        
        .message { max-width: 85%; padding: 1.25rem; border-radius: 1rem; line-height: 1.6; font-size: 0.95rem; }
        .message.user { align-self: flex-end; background: black; color: white; border-bottom-right-radius: 0; }
        .message.ai { align-self: flex-start; background: white; border: 1px solid var(--gray-200); border-bottom-left-radius: 0; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05); }
        
        /* Markdown-like Styles */
        .message.ai code { background: #F3F4F6; padding: 2px 6px; border-radius: 4px; font-family: monospace; color: #DB2777; font-size: 0.9em; }
        .message.ai pre { background: #1F2937; color: #F3F4F6; padding: 1rem; border-radius: 8px; overflow-x: auto; margin: 10px 0; font-family: monospace; }
        .message.ai strong { font-weight: 700; color: #111827; }
        .message.ai h3 { margin-top: 1rem; font-weight: 700; font-size: 1.1em; }
        .message.ai ul { margin-left: 1.2rem; }
        .message.ai li { margin-bottom: 0.5rem; }

        .loading-dots { display: flex; gap: 4px; padding: 10px; }
        .loading-dots div { width: 6px; height: 6px; background: var(--gray-500); border-radius: 50%; animation: bounce 1.4s infinite ease-in-out; }
        .loading-dots div:nth-child(1) { animation-delay: -0.32s; }
        .loading-dots div:nth-child(2) { animation-delay: -0.16s; }
        
        @keyframes bounce { 0%, 80%, 100% { transform: scale(0); } 40% { transform: scale(1); } }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            aside { display: none; } /* Hide sidebar on mobile for simplicity in this version */
            h1 { font-size: 2.5rem; }
            #messages-container { padding: 1rem; }
        }
    </style>
</head>
<body>

    <!-- Landing Page View -->
    <div id="landing-page">
        <nav>
            <div class="logo">
                <div class="logo-icon"><i data-lucide="terminal" width="18"></i></div>
                <span>LinuxTutor</span>
            </div>
            <button onclick="startChat(null)" class="exit-btn" style="background: black; color: white; padding: 8px 16px; border-radius: 99px;">Start Learning</button>
        </nav>

        <div class="hero">
            <div class="badge">
                <div class="dot"></div>
                AI Professor Mode Active
            </div>
            <h1>Your Personal <br><span style="color: var(--gray-200);">Linux Professor.</span></h1>
            <p class="subtitle">Master Linux based on your exact college syllabus. Ask questions, get code examples, and learn logic instantly.</p>

            <form onsubmit="handleLandingSubmit(event)" class="input-wrapper">
                <div style="padding-left: 1rem; color: var(--gray-400);"><i data-lucide="sparkles" width="20"></i></div>
                <input type="text" id="landing-input" placeholder="Ask a question (e.g., Explain 'grep' command)...">
                <button type="submit" class="send-btn"><i data-lucide="arrow-right" width="20"></i></button>
            </form>

            <div style="margin-top: 2rem; display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
                <button onclick="startChat('Explain Unit 3 Vi Editor')" style="border: none; background: none; color: var(--gray-500); text-decoration: underline; cursor: pointer;">Vi Editor</button>
                <button onclick="startChat('How do file permissions work?')" style="border: none; background: none; color: var(--gray-500); text-decoration: underline; cursor: pointer;">Permissions</button>
                <button onclick="startChat('Show me a Shell Script loop')" style="border: none; background: none; color: var(--gray-500); text-decoration: underline; cursor: pointer;">Shell Scripts</button>
            </div>
        </div>
    </div>

    <!-- Chat Interface View -->
    <div id="chat-interface" class="hidden">
        <aside>
            <div class="sidebar-header">
                <div class="logo">
                    <div class="logo-icon"><i data-lucide="book-open" width="18"></i></div>
                    <span style="font-size: 1rem;">Course Content</span>
                </div>
            </div>
            <div class="unit-list" id="unit-list">
                <!-- Units injected via JS -->
            </div>
        </aside>

        <main>
            <div class="chat-header">
                <button onclick="showLanding()" class="exit-btn">End Session</button>
            </div>
            
            <div id="messages-container">
                <!-- Messages injected here -->
            </div>

            <div style="padding: 1.5rem; background: white;">
                <form onsubmit="handleChatSubmit(event)" class="input-wrapper" style="box-shadow: 0 0 0 1px var(--gray-200);">
                    <input type="text" id="chat-input" placeholder="Ask follow-up questions...">
                    <button type="submit" id="chat-send-btn" class="send-btn"><i data-lucide="send" width="18"></i></button>
                </form>
            </div>
        </main>
    </div>

    <!-- Logic -->
    <script>
        // --- CONFIGURATION ---
        // Your API Key has been inserted here
        const API_KEY = "AIzaSyDTVaKWGatfAuhbn2W38tDM6c_Zn55LTrk"; 
        
        const SYLLABUS = `
        UNIT 1: INTRODUCTION (Architecture, Kernel, Shell).
        UNIT 2: FILES (cp, mv, rm, ls, mkdir).
        UNIT 3: VI EDITOR & PIPES (Modes, Redirection, Grep).
        UNIT 4: SECURITY (chmod, chown, Shell Vars).
        UNIT 5: LOGIC (If, Case, Loops, Scripts).
        `;

        // MODIFIED SYSTEM PROMPT FOR ELABORATE TEACHING & STRICT CONTROL
        const SYSTEM_PROMPT = `
        ROLE: Expert Linux Professor and Mentor.
        
        STRICT RULES:
        1. SCOPE: You MUST answer ONLY questions related to Linux and the syllabus provided.
        2. REFUSAL: If the user asks about ANYTHING else (e.g., cooking, windows, movies, life advice, python, java, general knowledge), you MUST refuse.
           - Refusal Message: "This topic is not covered in the Linux syllabus." (Output EXACTLY this sentence).
        3. TEACHING STYLE (ELABORATE): 
           - EXPLAIN DEEPLY: Do not give short answers. Provide a comprehensive, detailed explanation of the concept.
           - THE "WHY": Always explain *why* a command or concept exists, not just how to use it.
           - STEP-BY-STEP: Break down complex logic or scripts into numbered steps.
           - ANALOGIES: Use simple, real-world analogies to explain difficult technical concepts (e.g., comparing file permissions to keys).
           - EXAMPLES: Provide MULTIPLE code examples and edge cases.
        4. FORMAT:
           - Give the answer DIRECTLY. 
           - DO NOT use starting fillers like "Here is the explanation" or "Sure!".
           - DO NOT use ending fillers like "Hope this helps!".
        
        SYLLABUS REFERENCE: ${SYLLABUS}
        `;

        // --- STATE ---
        let messages = [];

        // --- INITIALIZATION ---
        lucide.createIcons();

        const units = [
            {id: 1, title: "Introduction"},
            {id: 2, title: "Files & Directories"},
            {id: 3, title: "Vi Editor"},
            {id: 4, title: "Securing Files"},
            {id: 5, title: "Shell Scripting"}
        ];

        // Render Sidebar Units
        const unitContainer = document.getElementById('unit-list');
        units.forEach(unit => {
            const btn = document.createElement('button');
            btn.className = 'unit-btn';
            btn.innerHTML = `<div class="unit-icon"><i data-lucide="terminal" width="16"></i></div>
                             <div style="text-align:left;">
                                <div style="font-weight:600; font-size: 0.9rem;">Unit ${unit.id}</div>
                                <div style="font-size: 0.75rem; color: var(--gray-500);">${unit.title}</div>
                             </div>`;
            btn.onclick = () => startChat(`Teach me Unit ${unit.id}: ${unit.title} elaborately.`);
            unitContainer.appendChild(btn);
        });
        lucide.createIcons(); // Re-run for new elements

        // --- FUNCTIONS ---

        function showLanding() {
            document.getElementById('landing-page').classList.remove('hidden');
            document.getElementById('chat-interface').classList.add('hidden');
            messages = [];
            document.getElementById('messages-container').innerHTML = '';
        }

        function startChat(initialMsg) {
            document.getElementById('landing-page').classList.add('hidden');
            document.getElementById('chat-interface').classList.remove('hidden');
            
            // Add Welcome Message
            if (messages.length === 0) {
                // UI only, don't send to API
                appendMessage('assistant', "Hello! I am your Linux Professor. I'm ready to teach you based on your syllabus.");
            }

            if (initialMsg) {
                sendMessage(initialMsg);
            }
        }

        function handleLandingSubmit(e) {
            e.preventDefault();
            const input = document.getElementById('landing-input');
            const text = input.value.trim();
            if (text) {
                startChat(text);
                input.value = '';
            }
        }

        function handleChatSubmit(e) {
            e.preventDefault();
            const input = document.getElementById('chat-input');
            const text = input.value.trim();
            if (text) {
                sendMessage(text);
                input.value = '';
            }
        }

        function appendMessage(role, text) {
            const container = document.getElementById('messages-container');
            const div = document.createElement('div');
            div.className = `message ${role === 'user' ? 'user' : 'ai'}`;
            
            // Enhanced Formatting to remove "stars" and "hyphens" by converting them to HTML
            // This turns Markdown syntax into "good readable text"
            let formattedText = text
                // 1. Remove Headers (#) but keep text bold/large
                .replace(/^### (.*$)/gim, '<h3>$1</h3>')
                .replace(/^## (.*$)/gim, '<h3>$1</h3>')
                .replace(/^# (.*$)/gim, '<h3>$1</h3>')
                
                // 2. Bold (**text**) -> Strong
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                
                // 3. Code Blocks
                .replace(/```([\s\S]*?)```/g, '<pre><code>$1</code></pre>')
                .replace(/`([^`]+)`/g, '<code>$1</code>') 
                
                // 4. Lists (Replace * or - with bullets)
                .replace(/^\s*[\-\*]\s+(.*)/gm, '<li>$1</li>')
                .replace(/(<li>.*<\/li>)/s, '<ul>$1</ul>') // Wrap li in ul (basic)
                
                // 5. Line breaks
                .replace(/\n/g, '<br>');

            // Cleanup any double bullets if regex misfired on mixed content, 
            // but primarily the goal is to hide the * char.
            
            div.innerHTML = formattedText;
            container.appendChild(div);
            container.scrollTop = container.scrollHeight;
        }

        async function sendMessage(text) {
            // 1. Add User Message to UI
            appendMessage('user', text);
            messages.push({ role: 'user', parts: [{ text: text }] });

            // 2. Show Loading
            const container = document.getElementById('messages-container');
            const loadingDiv = document.createElement('div');
            loadingDiv.className = 'message ai';
            loadingDiv.innerHTML = '<div class="loading-dots"><div></div><div></div><div></div></div>';
            loadingDiv.id = 'loading-indicator';
            container.appendChild(loadingDiv);
            container.scrollTop = container.scrollHeight;

            try {
                // 3. Call API
                const history = messages.map(m => ({ role: m.role === 'assistant' ? 'model' : 'user', parts: m.parts }));
                
                const response = await fetch(
                    `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${API_KEY}`,
                    {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: history,
                            systemInstruction: { parts: [{ text: SYSTEM_PROMPT }] }
                        })
                    }
                );

                const data = await response.json();
                
                // Remove Loading
                document.getElementById('loading-indicator').remove();

                if (data.error) {
                    appendMessage('assistant', "Error: " + data.error.message);
                } else {
                    let aiText = data.candidates[0].content.parts[0].text;
                    
                    // Final cleanup filter (Javascript side) to be safe
                    // Remove "Here is..." or "Hope this helps" if the AI slipped up
                    aiText = aiText.replace(/^(Here is|Sure|I can help|Here's).+?:\n/i, '');
                    aiText = aiText.replace(/(Hope this helps|Let me know|Happy learning).*$/i, '');

                    appendMessage('assistant', aiText.trim());
                    messages.push({ role: 'assistant', parts: [{ text: aiText }] });
                }

            } catch (error) {
                document.getElementById('loading-indicator').remove();
                appendMessage('assistant', "Connection failed. Please check your API Key in the code.");
                console.error(error);
            }
        }
    </script>
</body>
</html>
